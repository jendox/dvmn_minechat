# MineChat CLI утилиты

Набор асинхронных клиентов для чата Minechat:

- **listen-minechat.py** — подключается к чату, сохраняет историю сообщений и выводит их в реальном времени.
- **write-minechat.py** — отправляет сообщение в чат через авторизацию по токену или автоматическую регистрацию нового пользователя.

---

## Требования

- Python **>= 3.13**
- Установленный [uv](https://docs.astral.sh/uv/)

---

## Установка

#### Установите uv (если еще не установлен)

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

#### Клонируйте репозиторий

```bash
git clone https://github.com/jendox/dvmn_minechat.git
cd dvmn_minechat
```

#### Установите зависимости

```bash
uv sync
```

---

# Использование

# Скрипт прослушивания чата — `listen-minechat.py`

Асинхронно подключается к чату, пишет историю в файл и выводит сообщения в терминал.

## Запуск (по умолчанию)

```bash
uv run python listen-minechat.py
```

## Запуск с параметрами

```bash
uv run python listen-minechat.py   --host minechat.dvmn.org   --port 5000   --history ./minechat_history.txt
```

## Переменные окружения

Создайте `.env`:

```bash
touch .env
```

Добавьте параметры:

```env
MINECHAT_HOST=minechat.dvmn.org
MINECHAT_LISTEN_PORT=5000
MINECHAT_HISTORY=minechat_history.txt
```

## Параметры конфигурации (`listen-minechat.py`)

| Параметр       | По умолчанию           | Переменная окружения   | Описание                   |
|----------------|------------------------|-------------------------|----------------------------|
| `--host`       | `minechat.dvmn.org`    | `MINECHAT_HOST`         | Адрес сервера чата        |
| `--port`       | `5000`                 | `MINECHAT_LISTEN_PORT`  | Порт для чтения сообщений |
| `--history`    | `minechat_history.txt` | `MINECHAT_HISTORY`      | Файл истории сообщений    |

### Приоритет параметров

1. Аргументы командной строки  
2. Переменные окружения  
3. Значения по умолчанию  

---

# Скрипт отправки сообщений — `write-minechat.py`

Отправляет **одно** сообщение в чат, используя:

- токен существующего пользователя, или
- автоматическую регистрацию нового пользователя по никнейму.

---

## Быстрый запуск с токеном

```bash
uv run python write-minechat.py   --message "Привет из скрипта!"   --token ваш_токен
```

---

## Автоматическая регистрация нового пользователя

Если токен не указан, но передан ник:

```bash
uv run python write-minechat.py   --message "Всем привет!"   --nickname "NewUser123"
```

Скрипт:

1. Регистрирует нового пользователя  
2. Сохраняет данные в JSON-файл (`credentials.json` по умолчанию)  
3. Отправляет сообщение от созданного аккаунта  

---

## Переменные окружения для отправки сообщений

Пример `.env`:

```env
MINECHAT_HOST=minechat.dvmn.org
MINECHAT_WRITE_PORT=5050
MINECHAT_TOKEN=ваш_токен
MINECHAT_NICKNAME=NewUser123
MINECHAT_CREDENTIALS=credentials.json
```

---

## Параметры конфигурации (`write-minechat.py`)

| Параметр         | По умолчанию        | Переменная окружения    | Описание                                                              |
|------------------|---------------------|---------------------------|-----------------------------------------------------------------------|
| `--message/-m`   | **обязательный**    | —                         | Текст сообщения                                                       |
| `--host`         | `minechat.dvmn.org` | `MINECHAT_HOST`           | Адрес сервера                                                        |
| `--port`         | `5050`              | `MINECHAT_WRITE_PORT`     | Порт для отправки сообщений                                          |
| `--token`        | —                   | `MINECHAT_TOKEN`          | Токен для авторизации                                                |
| `--nickname`     | —                   | `MINECHAT_NICKNAME`       | Ник для регистрации нового пользователя                              |
| `--credentials`  | `credentials.json`  | `MINECHAT_CREDENTIALS`    | Файл для сохранения/чтения учётных данных                            |

---

## Порядок поиска токена

1. Аргумент `--token`  
2. Переменная окружения `MINECHAT_TOKEN`  
3. Содержимое файла `credentials.json`  

Если токена нет, но указан ник — выполняется регистрация.  
Если нет ни токена, ни никнейма — скрипт завершится с ошибкой.  

---

## Завершение работы

Остановить работу слушателя можно:

```
Ctrl + C
```
